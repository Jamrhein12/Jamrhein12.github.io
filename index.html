<html>
<script src='https://cdn.jsdelivr.net/npm/d3@7'></script>
<body onload='init()'>

<h1>NBA vs. NCAA Shooting Percentages Data</h1>

<p>Below are charts showing shooting percentage data of players in the NBA (National Basketball Association)
    and their respective shooting percentage data of when they played college basketball (NCAA)</p>

<p>These specific players were selected because they all played college basketball, started their career in
    or after the year 2000, and averaged 20 points per game or more in their NBA career.
</p>

<p>Average data for the NBA was taken from data from NBA players who played in the year 2018
    (the most recent year of the data) and have played atleast 100 career games.
</p>

<div id="datacontainer"></div>

<div id="averages"></div>

<svg id="chart1" width="800" height="400"></svg>

<script>

async function init() {

    const data = await d3.csv('https://Jamrhein12.github.io/players.csv');

    // Filter data to...
    // 1. Player played college basketball
    // 2. Player started career in or after 2000
    // 3. Player has a career nba ppg >= 20
    const filteredData = data.filter(row => 
        row.active_from >= 2000 && 
        row.college !== null && 
        row.college !== "" &&
        row.NBA_ppg >= 20.0);

    const filteredAvgData = data.filter(row =>
        row.active_from >= 2000 &&
        row.active_to >= 2018 &&
        row.NBA_g_played >= 100)

    console.log(filteredData);

    // Getting league averages
    // NBA averages
    const avg_nba_3ptpct = parseFloat(d3.mean(filteredAvgData, d => +d['NBA__3ptpct']).toFixed(2));
    console.log(avg_nba_3ptpct);
    const avg_nba_efgpct = parseFloat(d3.mean(filteredAvgData, d => +d['NBA_efgpct']).toFixed(2));
    console.log(avg_nba_efgpct);
    const avg_nba_fg = parseFloat(d3.mean(filteredAvgData, d => +d['NBA_fg%']).toFixed(2));
    console.log(avg_nba_fg);
    const avg_nba_ft = parseFloat(d3.mean(filteredAvgData, d => +d['NBA_ft%']).toFixed(2));
    console.log(avg_nba_ft);
    /*
    // NCAA averages
    const avg_ncaa_3ptpct = parseFloat(d3.mean(filteredAvgData, d => +d['NCAA__3ptpct']).toFixed(2));
    console.log(avg_ncaa_3ptpct);
    const avg_ncaa_efgpct = parseFloat(d3.mean(filteredAvgData, d => +d['NCAA_efgpct']).toFixed(2));
    console.log(avg_ncaa_efgpct);
    const avg_ncaa_fg = parseFloat(d3.mean(filteredAvgData, d => +d['NCAA_fgpct']).toFixed(2));
    console.log(avg_ncaa_fg);
    const avg_ncaa_ft = parseFloat(d3.mean(filteredAvgData, d => +d['NCAA_ft']).toFixed(2));
    console.log(avg_ncaa_ft);
    */

    d3.select('#datacontainer')
        .selectAll('p')
        .data(filteredData)
        .enter()
        .append('p')
        .html(function(d, i) { console.log("Index:", i, "Value:", d.name); return 'Name: ' + d.name + ' Career PPG: ' + d.NBA_ppg; });

    d3.select('#averages')
        .append('p')
        .html('Avg. NBA 3pt percentage: ' + avg_nba_3ptpct +
              '<br>Avg. NBA EFG pct: ' + avg_nba_efgpct +
              '<br>Avg. NBA FG percentage: ' + avg_nba_fg + 
              '<br>Avg. NBA FT percentage: ' + avg_nba_ft);

    const svgWidth = 800;
    const svgHeight = 400;
    const margin = { top: 20, right: 20, bottom: 40, left: 40 };
    const chartWidth = svgWidth - margin.left - margin.right;
    const chartHeight = svgHeight - margin.top - margin.bottom;

    const svg = d3.select('#chart1')
        .attr("width", svgWidth)
        .attr("height", svgHeight);

    const xScale = d3.scaleBand()
        .domain(filteredData.map(d => d.name))
        .range([margin.left, chartWidth + margin.left])
        .padding(0.1);

    const yScale = d3.scaleLinear()
    .domain([0, d3.max(filteredData, d => d.NBA__3ptpct)])
    .range([chartHeight, 0]);

    const xAxis = d3.axisBottom(xScale);
    const yAxis = d3.axisLeft(yScale);

    svg.append("g")
        .attr("transform", "translate(40, 760)")
        .call(xAxis);

    svg.append("g")
        .attr("transform", "translate(40, 0)")
        .call(yAxis);

    svg.selectAll(".bar")
        .data(filteredData)
        .enter()
        .append("rect")
        .attr("class", "bar")
        .attr("x", d => xScale(d.name))
        .attr("y", d => yScale(d.NBA__3ptpct))
        .attr("width", xScale.bandwidth())
        .attr("height", d => chartHeight - yScale(d.NBA__3ptpct))
        .attr("fill", "steelblue");

}

</script>
</body>
</html>
