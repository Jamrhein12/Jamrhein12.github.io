<html>
<script src='https://cdn.jsdelivr.net/npm/d3@7'></script>
<body onload='init()'>

<h1>NBA vs. NCAA Shooting Percentages Data</h1>

<p>Below are charts showing shooting percentage data of players in the NBA (National Basketball Association)
    and their respective shooting percentage data of when they played college basketball (NCAA)</p>

<p>These specific players were selected because they all played college basketball, started their career in
    or after the year 2000, and averaged 20 points per game or more in their NBA career.
</p>

<p>Average data for the NBA was taken from data from NBA players who played in the year 2018
    (the most recent year of the data) and have played atleast 100 career games.
</p>

<div id="datacontainer"></div>

<div id="averages"></div>

<h1 id="header">NBA Shooting Percentages</h1>

<button id="NBA_button">NBA shooting percentages</button>
<button id="NCAA_button">NCAA shooting percentages</button>
<button id="both_button">NBA/NCAA shooting percentages</button>

<p>Blue = 3 pt percentage<br>Green = FG percentage</p>

<svg id="chart1" width="2000" height="750"></svg>

<script>

async function init() {

    const data = await d3.csv('https://Jamrhein12.github.io/players.csv');

    // Filter data to...
    // 1. Player played college basketball
    // 2. Player started career in or after 2000
    // 3. Player has a career nba ppg >= 20
    const filteredData = data.filter(row => 
        row.active_from >= 2000 && 
        row.college !== null && 
        row.college !== "" &&
        row.NBA_ppg >= 20.0);

    const filteredAvgData = data.filter(row =>
        row.active_from >= 2000 &&
        row.active_to >= 2018 &&
        row.NBA_g_played >= 100)

    console.log(filteredData);

    // Getting league averages

    // NBA averages
    const avg_nba_3ptpct = parseFloat(d3.mean(filteredAvgData, d => +d['NBA__3ptpct']).toFixed(2));
    console.log(avg_nba_3ptpct);
    const avg_nba_fg = parseFloat(d3.mean(filteredAvgData, d => +d['NBA_fg%']).toFixed(2));
    console.log(avg_nba_fg);

    /*
    d3.select('#datacontainer')
        .selectAll('p')
        .data(filteredData)
        .enter()
        .append('p')
        .html(function(d, i) { console.log("Index:", i, "Value:", d.name); return 'Name: ' + d.name + ' Career PPG: ' + d.NBA_ppg; });
    */
    d3.select('#averages')
        .append('p')
        .html('Avg. NBA 3pt percentage: ' + avg_nba_3ptpct +
              '<br>Avg. NBA FG percentage: ' + avg_nba_fg +
              '<br><br><br>');

// Global chart dimensions

    const svgWidth = 2000;
    const svgHeight = 750;
    const margin = { top: 50, right: 50, bottom: 50, left: 50 };
    const chartWidth = svgWidth - margin.left - margin.right;
    const chartHeight = svgHeight - margin.top - margin.bottom;

//////////////////////////////////////////////
// NBA chart
//////////////////////////////////////////////

    const svg = d3.select('#chart1')
        .attr("width", svgWidth)
        .attr("height", svgHeight);

    const xScale = d3.scaleBand()
        .domain(filteredData.map(d => d.name))
        .range([margin.left, chartWidth + margin.left])
        .padding(0.1);

    const yScale = d3.scaleLinear()
    .domain([0, d3.max(filteredData, d => Math.max(d['NBA__3ptpct'], d['NBA_efgpct'], d['NBA_fg%']))])
    .range([chartHeight, 0]);

    const xAxis = d3.axisBottom(xScale);
    const yAxis = d3.axisLeft(yScale);

    svg.append("g")
        .attr("transform", "translate(0, 700)")
        .call(xAxis);

    svg.append("g")
        .attr("transform", "translate(50, 0)")
        .call(yAxis);

    svg.selectAll(".group")
        .data(filteredData)
        .enter()
        .append("g")
        .attr("class", "group")
        .attr("transform", d => `translate(${xScale(d.name)}, 0)`)
        .selectAll(".bar")
        .data(d => [d['NBA__3ptpct'], d['NBA_fg%']])
        .enter()
        .append("rect")
        .attr("class", "bar")
        .attr("x", (d, i) => i * (xScale.bandwidth() / 2))
        .attr("y", d => yScale(d))
        .attr("width", xScale.bandwidth() / 2)
        .attr("height", d => chartHeight + margin.top - yScale(d))
        .attr("fill", (d, i) => ["steelblue", "orange"][i]);

    const nba_button = document.getElementById("NBA_button");
    const ncaa_button = document.getElementById("NCAA_button");
    const both_button = document.getElementById("both_button");

    const header = document.getElementById("header");

    nba_button.addEventListener("click", function() {
        console.log("nba_button clicked");
        header.textContent = "NBA Shooting Percentages";

        svg.selectAll(".bar")
            .data(d => [d['NBA__3ptpct'], d['NBA_fg%']])
            .attr("y", d => yScale(d))
            .attr("height", d => chartHeight + margin.top - yScale(d));

    });

    ncaa_button.addEventListener("click", function() {
        console.log("ncaa_button clicked");
        header.textContent = "NCAA Shooting Percentages";

        svg.selectAll(".bar")
            .data(d => [d['NCAA__3ptpct'], d['NCAA_fgpct']])
            .attr("y", d => yScale(d))
            .attr("height", d => chartHeight + margin.top - yScale(d));

    });

    both_button.addEventListener("click", function() {
        console.log("both_button clicked");
        header.textContent = "NBA/NCAA Shooting Percentages";
    })


/////////////////////////////////////////////
// NCAA chart
/////////////////////////////////////////////
/*
    svg1.selectAll(".group")
        .data(filteredData)
        .enter()
        .append("g")
        .attr("class", "group")
        .attr("transform", d => `translate(${xScale1(d.name)}, 0)`)
        .selectAll(".bar")
        .data(d => [d['NCAA__3ptpct'], d['NCAA_efgpct'], d['NCAA_fgpct']])
        .enter()
        .append("rect")
        .attr("class", "bar")
        .attr("x", (d, i) => i * (xScale1.bandwidth() / 3))
        .attr("y", d => yScale1(d))
        .attr("width", xScale1.bandwidth() / 3)
        .attr("height", d => chartHeight + margin.top - yScale1(d))
        .attr("fill", (d, i) => ["steelblue", "orange", "green"][i]);
*/
}

</script>
</body>
</html>
